<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin - View Issues</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <div class="navbar-logo">
        <img src="{{ url_for('static', filename='images/logo.jpeg') }}" alt="Community Logo">
        <span>FixItUp - Admin</span>
    </div>
    <ul class="navbar-links">
        <li><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
        <li><a href="{{ url_for('admin_logout') }}">Logout</a></li>
    </ul>
</nav>

<section class="section">
    <h2>Reported Issues</h2>

   <!-- Filter and Sort Form -->
<!-- Filter, Sort, and Search Form -->
<form method="get" action="{{ url_for('view_issues') }}" style="margin-bottom: 20px;">
    <label>Status:</label>
    <select name="status">
        <option value="">All</option>
        <option value="pending" {% if request.args.get('status') == 'pending' %}selected{% endif %}>Pending</option>
        <option value="in-progress" {% if request.args.get('status') == 'in-progress' %}selected{% endif %}>In Progress</option>
        <option value="resolved" {% if request.args.get('status') == 'resolved' %}selected{% endif %}>Resolved</option>
    </select>

    <label>Sort:</label>
    <select name="sort">
        <option value="desc" {% if request.args.get('sort') == 'desc' or not request.args.get('sort') %}selected{% endif %}>Newest First</option>
        <option value="asc" {% if request.args.get('sort') == 'asc' %}selected{% endif %}>Oldest First</option>
    </select>

    <label>Email:</label>
    <input type="text" name="user_email" placeholder="Enter user email" value="{{ request.args.get('user_email', '') }}" style="padding: 4px; width: 200px;">

    <button type="submit" class="btn-primary">Apply</button>
</form>



    <!-- Issues Table -->
<table style="width:100%; margin-top:20px; border-collapse:collapse;">
    <thead>
        <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Status</th>
            <th>Reported By</th>
            <th>Date</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for issue in issues %}
        <tr style="border-bottom: 1px solid #ccc;">
            <td>{{ issue.title }}</td>
            <td>{{ issue.description }}</td>
            <td>
                <form method="POST" action="{{ url_for('update_issue_status', issue_id=issue.id) }}">
                    <select name="status" onchange="this.form.submit()">
                        <option value="pending" {% if issue.status == 'pending' %}selected{% endif %}>Pending</option>
                        <option value="in-progress" {% if issue.status == 'in-progress' %}selected{% endif %}>In Progress</option>
                        <option value="resolved" {% if issue.status == 'resolved' %}selected{% endif %}>Resolved</option>
                    </select>
                </form>
            </td>
            <td>{{ issue.reported_by.name if issue.reported_by else 'N/A' }}</td>
            <td>{{ issue.created_at.strftime('%Y-%m-%d') }}</td>
            <td>
                <form method="POST" action="{{ url_for('delete_issue', issue_id=issue.id) }}" onsubmit="return confirm('Are you sure you want to delete this issue?');">
                    <button type="submit" style="background-color:red; color:white; border:none; padding:5px 10px; cursor:pointer;">Delete</button>
                </form>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

</section>

<!-- Footer -->
<footer>
    <div class="footer-content">
        <div class="footer-logo" style="margin-left: 20px; margin-top: 10px;">
            <img src="{{ url_for('static', filename='images/logo.jpeg') }}" alt="Logo">
        </div>
        <div class="footer-social">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-linkedin-in"></i></a>
        </div>
    </div>
    <p class="footer-bottom">&copy; 2025 FixItUp Admin. All rights reserved.</p>
</footer>

</body>
</html>
